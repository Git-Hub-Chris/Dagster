---
title: "Using Dagster Pipes, Part two: Modify external code | Dagster Docs"
description: "With Dagster Pipes, you can incorporate existing code into Dagster without huge refactors. This guide shows you how to modify existing code to work with Dagster Pipes."
---

# Modify external code to work with Dagster Pipes

<Note>

This is part two of the [Dagster Pipes + subprocess](/guides/dagster-pipes/subprocess) tutorial.

</Note>

At this point, you should have two files:

- `external_code.py` which is a standalone Python script that you want to orchestrate with Dagster.
- `dagster_subprocess_pipes.py` which includes a Dagster asset and a Dagster definitions.

In this section, you'll learn how to modify the standalone Python script to work with [Dagster Pipes](/guides/dagster-pipes) in order to stream information back to Dagster. To do this, you'll:

- [Make Dagster context available in existing code](#step-1-make-dagster-context-available-in-existing-code)
- [Stream log messages from subprocess back to Dagster](#step-2-send-log-messages-to-dagster)
- [Stream structured metadata from subprocess back to Dagster](#step-3-send-structured-metadata-to-dagster)

---

## Step 1: Make Dagster context available in existing code

Getting existing code to work with Dagster Pipes requires adding a few lines of code:

- Imports from `dagster-pipes`

- A call that connects to Dagster Pipes: <PyObject module="dagster_pipes" object="open_dagster_pipes"/> initializes the Dagster Pipes context that can be used to stream information back to Dagster. It is recommended to call this function near the entry point of a pipes process.

  <Note>

  The with <code>with open_dagster_pipes() as context:</code> is a context manager in Python, ensuring resource setup and cleanup for a specific segment of code. It's useful for tasks requiring initial setup and final teardown, like opening and closing connections. In this case, the context manager is used to initialize and close the Dagster Pipes connection.

  </Note>

- An instance of the Dagster Pipes context via <PyObject module="dagster_pipes" object="PipesContext" method="get"/>.

In our sample Python script, the changes would look like the following:

```python file=/guides/dagster/dagster_pipes/subprocess/external_code_with_context.py
import pandas as pd
from dagster_pipes import PipesContext, open_dagster_pipes


def main():
    orders_df = pd.DataFrame({"order_id": [1, 2], "item_id": [432, 878]})
    total_orders = len(orders_df)
    # get the Dagster Pipes context
    context = PipesContext.get()
    ...


if __name__ == "__main__":
    # connect to Dagster Pipes
    with open_dagster_pipes() as context:
        main()
```

---

## Step 2: Send log messages to Dagster

Dagster Pipes context offers a built-in logging capability that enables you to stream log messages back to Dagster:

```python file=/guides/dagster/dagster_pipes/subprocess/external_code_with_logs.py
import pandas as pd
from dagster_pipes import PipesContext, open_dagster_pipes


def main():
    orders_df = pd.DataFrame({"order_id": [1, 2], "item_id": [432, 878]})
    total_orders = len(orders_df)
    # get the Dagster Pipes context
    context = PipesContext.get()
    # send log messages back to Dagster
    context.log.info(f"processing total {total_orders} orders")


if __name__ == "__main__":
    # connect to Dagster Pipes
    with open_dagster_pipes() as context:
        main()
```

- <PyObject module="dagster_pipes" object="open_dagster_pipes" /> constructs a context
  manager that establishes a connection with Dagster Pipes. It returns a <PyObject
    module="dagster_pipes"
    object="PipesContext"
  /> object.
- Inside the context, `context.log.info(...)` is a method call that sends a log message back to Dagster.

Then, the log messages will show up in the Dagster UI. You can filter the log levels to only view `info` level messages:

1. Click the **Levels** filter next to the log filter field. This will present a dropdown of all log levels.
2. Select the **info** checkbox and deselect the others. This will show only the logs marked as **info** level.

<Image
  alt="Send log messages to Dagster"
  src="/images/guides/dagster-pipes/modifying-code-4-log-messages.png"
  width={1326}
  height={742}
/>

## Step 3: Send structured metadata to Dagster

Sometimes, you may want to log information from your external code to be structured metadata in Dagster. Dagster Pipes context also comes the ability to log structured metadata back to Dagster.

#### Report asset materialization

Similar to [reporting materialization metadata within the Dagster process](/concepts/assets/software-defined-assets#reporting-materialization-metadata), you can also report asset materialization back to Dagster from the external process.

In this example, we’re passing a piece of metadata named `total_orders` to the `metadata` parameter of the <PyObject module="dagster_pipes" object="PipesContext" method="report_asset_materialization" />. This payload will be sent from the external process back to Dagster:

```python file=/guides/dagster/dagster_pipes/subprocess/external_code_with_events.py startafter=start_events_marker endbefore=end_events_marker
# get the Dagster Pipes context
    context = PipesContext.get()
    # send structured metadata back to Dagster
    context.report_asset_materialization(metadata={"total_orders": total_orders})
```

Then, total_orders will show up in the UI as structured metadata:

<Image
  alt="Report asset materialization to Dagster"
  src="/images/guides/dagster-pipes/modifying-code-5-1-report-asset-materialization.png"
  width={1412}
  height={806}
/>

This metadata will also be displayed on the Events tab of the Asset Details page in the UI:

<Image
  alt="View materialization events in asset details page"
  src="/images/guides/dagster-pipes/modifying-code-5-2-materialization-asset-details.png"
  width={1286}
  height={736}
/>

#### Report asset checks

Dagster allows you to define and execute data quality checks on assets. Refer to the [Asset Checks](/concepts/assets/asset-checks) documentation for more information.

If your asset has data quality checks defined, you can report to Dagster that an asset check has been performed via <PyObject module="dagster_pipes" object="PipesContext" method="report_asset_check" />:

```python file=/guides/dagster/dagster_pipes/subprocess/external_code_with_events.py startafter=start_checks_marker endbefore=end_checks_marker dedent=4
# report data quality check result back to Dagster
context.report_asset_check(
    asset_key="my_asset",
    passed=orders_df[["item_id"]].notnull().all().bool(),
    check_name="no_empty_order_check",
)
```

When Dagster executes the code, you’ll see an asset check event with the check result in the UI:

<Image
  alt="Report asset checks to Dagster"
  src="/images/guides/dagster-pipes/modifying-code-5-3-report-asset-checks.png"
  width={1312}
  height={734}
/>

This check result will also be displayed on the Checks tab of the Asset Details page in the UI:

<Image
  alt="View checks in asset details page"
  src="/images/guides/dagster-pipes/modifying-code-5-4-checks-asset-details.png"
  width={1302}
  height={730}
/>

---

## What's next?

At this point, you've learned how to get access to Dagster Pipes context, report log messages events from the external process, and structured events back to Dagster.

What's next? From here, you can:

- Learn about other usage of Dagster Pipes with other entities in the Dagster system in the [Reference](/guides/dagster-pipes/subprocess/reference) section
- Learn about [other integrations with Dagster Pipes](/guides/dagster-pipes#usage).
- Learn how to [customize your own Dagster Pipes protocols](/customizing-dagster-pipes-protocols).
